{"ast":null,"code":"import _defineProperty from \"/Users/eandersson018/Documents/Workspace/eve/veyor/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport QueryString from 'query-string';\n/**\n * A method that calls an API endpoint with the specified method and params\n * @param  {String} endpoint       The URL to call\n * @params {Object}                Additional options\n */\n\nconst callApi = (endpoint, {\n  method = 'get',\n  params = {}\n} = {}) => {\n  let reqBody = params;\n  let queryString = '';\n  const headers = {\n    'Content-Type': 'application/json'\n  };\n\n  if (method === 'get') {\n    // We can't have a body on a get request as it will silently fail\n    reqBody = null;\n    if (params && Object.keys(params).length) queryString = \"?\".concat(QueryString.stringify(params));\n  }\n\n  console.log('calling endpoint', \"\".concat(endpoint).concat(queryString));\n  return fetch(\"\".concat(endpoint).concat(queryString), {\n    headers,\n    method,\n    body: reqBody\n  }).then(response => {\n    console.log('we got', response);\n    return response.ok ? response.json : response.json().then(json => Promise.reject(_objectSpread({}, response, {}, json)));\n  });\n};\n/**\n * This is a dispatch specific version of the callApi method that can be used with actions\n * It returns a function that matches the expected shape for a thunk action\n *\n * @method callApiWithDispatch\n * @param {Function} callback Should be a function of the form (dispatch, state, promise)\n *                            and return a promise\n */\n\n\nconst callApiWithDispatch = (endpoint, options = {}, callbackPromiseFunction) => {\n  return (dispatch, getState) => {\n    const state = getState();\n    options.params = options.params || {};\n    const apiPromise = callApi(endpoint, options, dispatch).then(result => result).catch(error => {\n      throw error;\n    });\n    const callbackPromise = callbackPromiseFunction ? callbackPromiseFunction(dispatch, state, apiPromise) : apiPromise;\n    if (!callbackPromise.then) throw Error('Callback function did not return a promise');\n    return callbackPromise;\n  };\n};\n\nexport { callApi, callApiWithDispatch };","map":{"version":3,"sources":["/Users/eandersson018/Documents/Workspace/eve/veyor/client/src/core/lib/apiHelpers.js"],"names":["QueryString","callApi","endpoint","method","params","reqBody","queryString","headers","Object","keys","length","stringify","console","log","fetch","body","then","response","ok","json","Promise","reject","callApiWithDispatch","options","callbackPromiseFunction","dispatch","getState","state","apiPromise","result","catch","error","callbackPromise","Error"],"mappings":";;;;;;AAAA,OAAOA,WAAP,MAAwB,cAAxB;AAEA;;;;;;AAKA,MAAMC,OAAO,GAAG,CACdC,QADc,EAEd;AACEC,EAAAA,MAAM,GAAG,KADX;AAEEC,EAAAA,MAAM,GAAG;AAFX,IAGI,EALU,KAMX;AACH,MAAIC,OAAO,GAAGD,MAAd;AACA,MAAIE,WAAW,GAAG,EAAlB;AAEA,QAAMC,OAAO,GAAG;AACd,oBAAgB;AADF,GAAhB;;AAIA,MAAIJ,MAAM,KAAK,KAAf,EAAsB;AACpB;AACAE,IAAAA,OAAO,GAAG,IAAV;AACA,QAAID,MAAM,IAAII,MAAM,CAACC,IAAP,CAAYL,MAAZ,EAAoBM,MAAlC,EAA0CJ,WAAW,cAAON,WAAW,CAACW,SAAZ,CAAsBP,MAAtB,CAAP,CAAX;AAC3C;;AAEFQ,EAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ,YAAmCX,QAAnC,SAA8CI,WAA9C;AAEC,SAAOQ,KAAK,WAAIZ,QAAJ,SAAeI,WAAf,GAA8B;AAAEC,IAAAA,OAAF;AAAWJ,IAAAA,MAAX;AAAmBY,IAAAA,IAAI,EAAEV;AAAzB,GAA9B,CAAL,CACNW,IADM,CACDC,QAAQ,IAAI;AAChBL,IAAAA,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBI,QAAtB;AACA,WAAOA,QAAQ,CAACC,EAAT,GACHD,QAAQ,CAACE,IADN,GAEHF,QAAQ,CAACE,IAAT,GAAgBH,IAAhB,CAAqBG,IAAI,IAAIC,OAAO,CAACC,MAAR,mBAAoBJ,QAApB,MAAiCE,IAAjC,EAA7B,CAFJ;AAGD,GANM,CAAP;AAOD,CA7BD;AA+BA;;;;;;;;;;AAQA,MAAMG,mBAAmB,GAAG,CAACpB,QAAD,EAAWqB,OAAO,GAAG,EAArB,EAAyBC,uBAAzB,KAAqD;AAE/E,SAAO,CAACC,QAAD,EAAWC,QAAX,KAAwB;AAC7B,UAAMC,KAAK,GAAGD,QAAQ,EAAtB;AACAH,IAAAA,OAAO,CAACnB,MAAR,GAAiBmB,OAAO,CAACnB,MAAR,IAAkB,EAAnC;AAEA,UAAMwB,UAAU,GAAG3B,OAAO,CAACC,QAAD,EAAWqB,OAAX,EAAoBE,QAApB,CAAP,CAClBT,IADkB,CACba,MAAM,IAAIA,MADG,EAElBC,KAFkB,CAEZC,KAAK,IAAI;AACd,YAAMA,KAAN;AACD,KAJkB,CAAnB;AAMA,UAAMC,eAAe,GAAGR,uBAAuB,GAC3CA,uBAAuB,CAACC,QAAD,EAAWE,KAAX,EAAkBC,UAAlB,CADoB,GAE3CA,UAFJ;AAIA,QAAI,CAACI,eAAe,CAAChB,IAArB,EAA2B,MAAMiB,KAAK,CAAC,4CAAD,CAAX;AAE3B,WAAOD,eAAP;AACD,GAjBD;AAkBD,CApBD;;AAsBA,SAAS/B,OAAT,EAAkBqB,mBAAlB","sourcesContent":["import QueryString from 'query-string'\n\n/**\n * A method that calls an API endpoint with the specified method and params\n * @param  {String} endpoint       The URL to call\n * @params {Object}                Additional options\n */\nconst callApi = (\n  endpoint,\n  {\n    method = 'get',\n    params = {},\n  } = {}\n) => {\n  let reqBody = params\n  let queryString = ''\n\n  const headers = {\n    'Content-Type': 'application/json'\n  }\n\n  if (method === 'get') {\n    // We can't have a body on a get request as it will silently fail\n    reqBody = null\n    if (params && Object.keys(params).length) queryString = `?${QueryString.stringify(params)}`\n  }\n\n\tconsole.log('calling endpoint', `${endpoint}${queryString}`)\n\n  return fetch(`${endpoint}${queryString}`, { headers, method, body: reqBody })\n  .then(response => {\n    console.log('we got', response)\n    return response.ok\n      ? response.json\n      : response.json().then(json => Promise.reject({ ...response, ...json }))\n  })\n}\n\n/**\n * This is a dispatch specific version of the callApi method that can be used with actions\n * It returns a function that matches the expected shape for a thunk action\n *\n * @method callApiWithDispatch\n * @param {Function} callback Should be a function of the form (dispatch, state, promise)\n *                            and return a promise\n */\nconst callApiWithDispatch = (endpoint, options = {}, callbackPromiseFunction) => {\n\n  return (dispatch, getState) => {\n    const state = getState()\n    options.params = options.params || {}\n\n    const apiPromise = callApi(endpoint, options, dispatch)\n    .then(result => result)\n    .catch(error => {\n      throw error\n    })\n\n    const callbackPromise = callbackPromiseFunction\n      ? callbackPromiseFunction(dispatch, state, apiPromise)\n      : apiPromise\n\n    if (!callbackPromise.then) throw Error('Callback function did not return a promise')\n\n    return callbackPromise\n  }\n}\n\nexport { callApi, callApiWithDispatch }\n"]},"metadata":{},"sourceType":"module"}